<!DOCTYPE html PUBLIC "-//Tigris//DTD XHTML 1.0 Transitional//EN" "http://style.tigris.org/nonav/tigris_transitional.dtd">
<html>
<head>
<link rel="SHORTCUT ICON" href="https://opends.dev.java.net/public/images/opends_favicon.gif">
<style type="text/css"> 
/* <![CDATA[ */
 @import "/branding/css/tigris.css";
 @import "/branding/css/inst.css";
 /* ]]> */
</style>
<link rel="stylesheet" type="text/css" href="/branding/css/print.css" media="print" />
<link rel="stylesheet" href="../../css/opends.css" type="text/css">
<title>OpenDS Unit Test Instructions</title>
</head>
<body>
<table class="tertmasttable" width="100%" cellspacing="0">
  <tbody>
    <tr>
      <td><div class="collectionheader">OpenDS Unit Test Instructions </div></td>
      <td width="10%" style="vertical-align:bottom"><a href="https://opends.dev.java.net/"><img src="../../images/opends_logo_sm.png" alt="OpenDS Logo" width="104" height="33" border="0" align="bottom"></a></td>
    </tr>
  </tbody>
</table>
<hr noshade size="1" ><br />
Unit tests in OpenDS is designed for developers to quickly identify 
and fix changes in the code that causes regressions. It usually involves
writing test cases that will try to execute every line of code in all
methods. OpenDS uses the <a href="http://testng.org">TestNG</a> 
open source testing framework.<br>
<h3>Running the Tests</h3>
There are groups of unit tests for OpenDS. Most test cases that run in a short
amount of time belong to the default test group. However, there are some more
intensive test cases that require more time to run. These tests belong to the
"slow" test group which are only run when necessary to make sure build times
are not excessively long. These tests only run for the "testall", 
"testallwithcoverage", and "all" build targets.
To run the default test group from the command line, use the command:
<blockquote> <code>./build.sh test</code> on UNIX<br> 
<code>./build.bat test</code> on Windows </blockquote>
To run all the tests including the slow test group from the command line, use the command:
<blockquote> <code>./build.sh testall</code> on UNIX<br> 
<code>./build.bat testall</code> on Windows </blockquote>
The tests can also be invoked from within NetBeans. Please see the 
<a href="http://blogs.sun.com/xzajo/entry/test_ng_plugin_for_netbeans">TestNG plugin for
NetBeans 5.0 page</a> for instructions on how to download and install the plugin.
TestNG plugins for <a href="http://testng.org/doc/idea.html">IDEA</a> or 
<a href="http://testng.org/doc/eclipse.html">Eclipse IDE</a> are also available.<br>
<blockquote>NOTE: In order to run tests from within NetBeans or another IDE, provide the JVM argument
<code>-Dorg.opends.server.BuildRoot=${basedir}</code> in run/debug properties. 
Replace ${basedir} with the path to the directory where OpenDS was checked out from SVN.</blockquote>
TestNG will print out the test results when the tests are finished. It also 
provides detailed HTML based reports listing all test cases that were run
along with their results. The reports are located at 
<code>build/unit-tests/report/OpenDS/index.html</code><br>
<br>
Code coverage information is also available with EMMA, the open source code
coverage toolkit. To generate code coverage reports for the default test group,
simply issue the command:
<blockquote> <code>./build.sh testwithcoverage</code> on UNIX<br>
<code>./build.bat testwithcoverage</code> on Windows </blockquote>
To generate code coverage reports for the all tests,
simply issue the command:
<blockquote> <code>./build.sh testallwithcoverage</code> on UNIX<br>
<code>./build.bat testallwithcoverage</code> on Windows </blockquote>
The HTML based coverage reports can be found at 
<code>build/coverage/report/index.html</code>.<br>
<h3>Writing Tests</h3>
The unit test source directory is located in 
<code>tests/unit-tests-testng</code> and follows the same structure as
the OpenDS source code. Please put the test classes in the same packages
as the classes they are testing. <br>
<br>
TestNG uses <a href="http://java.sun.com/j2se/1.5.0/docs/guide/language/annotations.html">
Java Annotations</a>. Please refer to the
<a href="http://testng.org/doc/documentation-main.html#annotations">TestNG documentation</a>
for a list of available annotations. Test case methods are annotated with <code>@Test</code>
before the method signature. These test cases are run as part of the default test group. For
slow test cases that should only run as part of the "slow" test group, use the <code>groups</code>
attribute for the <code>@Test</code> annotation with the value of <code>"slow"</code>. 
(ie. <code>@Test(groups = { "slow" })</code>).<br>
<br>
The TestNG configuration file might need to be modified for the new tests to run. 
The file is located at <code>ext/testng/testng.xml</code>. Make sure the package in 
which your test classes belongs to is included in the <code>&lt;packages&gt;</code> tag. 
Test classes can also be specified explicitly in the <code>&lt;classes&gt;</code> tag. 
Please keep the configuration file as simple as possible. For example, when TestNG provides
the option of specifying an option in the configuration file or in the test code itself, favor
using the test code.<br>
<h3>Test Environment</h3>
Not only does test classes have access to all the internal and external API of OpenDS,
it can also start an instance of OpenDS for running protocol level tests. The 
<code>TestCaseUtils</code> class includes several methods for manipulating the test
environment. The test environment server root is located at <code>build/package</code>.<br>
<br>
When the <code>startServer()</code> method is called to start the test environment server,
it applies any configuration changes in the LDIF file at 
<code>tests/unit-tests-testng/resource/config-changes.ldif</code> on top of the default 
server configuration. LDIF adds, deletes, modifies to the configuration can be included
in this file to tailor the test environment server to special test cases.<br>
<br>
</body>
</html>

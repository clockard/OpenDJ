<!DOCTYPE html PUBLIC "-//Tigris//DTD XHTML 1.0 Transitional//EN" "http://style.tigris.org/nonav/tigris_transitional.dtd">
<html>
<head>
<link rel="SHORTCUT ICON" href="https://opends.dev.java.net/public/images/opends_favicon.gif">
<style type="text/css"> 
/* <![CDATA[ */
 @import "/branding/css/tigris.css";
 @import "/branding/css/inst.css";
 /* ]]> */
</style>
<link rel="stylesheet" type="text/css" href="/branding/css/print.css" media="print" />
<link rel="stylesheet" href="../../css/opends.css" type="text/css">
<title>OpenDS Synchronization Configuration</title>
</head>
<body>
<table class="tertmasttable" width="100%" cellspacing="0">
  <tbody>
    <tr>
      <td><div class="collectionheader">Configuring Synchronization </div></td>
      <td width="10%" style="vertical-align:bottom"><a href="https://opends.dev.java.net/"><img src="../../images/opends_logo_sm.png" alt="OpenDS Logo" width="104" height="33" border="0" align="bottom"></a></td>
    </tr>
  </tbody>
</table>
<hr noshade size="1" >
<br />
Synchronization is still a work in progress feature, as such it does not yet have all the configuration facilities and graphical interfaces that will be available in the final release.<br>
For the people that may want to try synchronization today here are 2 recipes that should help setting up synchronization quickly.<br>
<h1>Setting Up Synchronization Between 2 Masters.</h1>
Because high availability is generally a primary concern for people using synchronization, the changelog service needs to run on both hosts. For simplicity the changelog service is run in the same process as the LDAP process.<br>
<h3>Setup first server</h3>
<ul>
  <li>Put build/package/OpenDS.zip on first server.</li>
  <li>Unzip in your choosen directory.</li>
  <li>Edit config/config.ldif</li>
  <ul>
    <li>set the port number (entry cn=LDAP Connection Handler,cn=Connection Handlers,cn=config , attribute <tt>ds-cfg-listen-port</tt>) and base-dn (<tt>entry ds-cfg-backend-id=userRoot,cn=Backends,cn=config, attribute ds-cfg-backend-base-dn</tt>)</li>
    <li>Enable the synchronization plugin (copy entry <tt>cn=Multimaster Synchronization,cn=Synchronization Providers,cn=config</tt> from resource/config/synchronization.ldif)</li>
    <li>configure the server as a changelog server</li>
    <ul>
      <li>&nbsp;copy entry : <tt>cn=Changelog Server, </tt><tt>cn=Multimaster Synchronization,cn=Synchronization Providers, </tt><tt>cn=config</tt> from resource/config/synchronization.ldif</li>
      <li>edit the <tt>ds-cfg-changelog-port</tt> attribute to set the port number of this changelog server</li>
      <li>edit the <tt>ds-cfg-changelog-server</tt> attribute to set the hostname and port number of the second changelog server</li>
      <li>set the <tt>ds-cfg-changelog-server-id</tt> attribute to 1</li>
    </ul>
    <li>configure the suffix base-dn that need to be synchronized.</li>
    <ul>
      <li>&nbsp;copy entry <tt>cn=example, cn=Multimaster Synchronization,cn=Synchronization Providers,cn=config</tt> from resource/config/synchronization.ldif</li>
      <li>edit the <tt>ds-cfg-synchronization-dn</tt> attribute to set the base-dn of entries that need to be synchronized.</li>
      <li>edit the <tt>ds-cfg-changelog-server</tt> attribute to set the hostnames and ports of the 2 changelog servers</li>
      <li>set the <tt>ds-cfg-directory-server-id</tt> attribute to 1</li>
    </ul>
  </ul>
  <li>Start the server (bin/start-ds.sh or bin/start-ds.bat)</li>
  <li>Populate the data (use ldapmodify)</li>
</ul>
<h3>Setup second server</h3>
<ul>
  <li>rcp or ftp the whole directory OpenDS-0.1 to the second hosts</li>
  <li>Edit config/config.ldif on the second host</li>
  <ul>
    <li>Configure the LDAP server :</li>
    <ul>
      <li>Change the <tt>ds-cfg-directory-server-id </tt>attribute from entry <tt>cn=example,cn=Multimaster Synchronization,cn=Synchronization Providers,cn=config</tt> to a value different from the&nbsp; value of the first server (for example : 2)</li>
    </ul>
    <li>Configure the Changelog server.</li>
    <ul>
      <li>change the <tt>ds-cfg-changelog-server-id</tt> attribute from entry <tt>cn=Changelog Server,</tt><tt>cn=Multimaster Synchronization, cn=Synchronization Providers, </tt><tt>cn=config</tt> to a value different from&nbsp; the value of the first server (for example : 2)</li>
      <li>edit the <tt>ds-cfg-changelog-port</tt> attribute to set the port number of this changelog server</li>
      <li>edit the <tt>ds-cfg-changelog-server</tt> attribute to set the hostname and port number of the other changelog server.</li>
    </ul>
  </ul>
  <li>Start the second server (bin/start-ds.sh or bin/start-ds.bat)</li>
</ul>
<h3>Test that synchronization is working</h3>
<ul>
  <li>Perform an ldapmodify on a synchronized entry on the first server.</li>
  <li>Check with ldapsearch that modification is visible on second server.</li>
</ul>
<h3>Check the monitoring information on both servers</h3>
All information about synchronization is readable by querying the <br>
cn=monitor base-dn using :<br>
l<tt>dapsearch -b cn=monitor "base-dn=&lt;your base dn&gt;"</tt><br>
<h4>Information about the LDAP server connection to the changelog server</h4>
entries look like :<br>
<tt>dn: cn=synchronization plugin dc=com,cn=monitor<br>
objectClass: top<br>
objectClass: extensibleObject<br>
debug-count: 0<br>
received-updates: 0<br>
server-state: 0000010c62b94fec00000001 Wed Jul 12 14:32:27 CEST 2006<br>
replayed-updates: 0<br>
pending-updates: 0<br>
connected-to: furon/127.0.0.1:8989<br>
base-dn: dc=com<br>
replayed-updates-ok: 1<br>
sent-updates: 1<br>
cn: synchronization plugin dc=com</tt><br>
<tt><br>
server-state</tt> attributes values give information about the last change <br>
that was received from each LDAP server<br>
<tt>connected-to</tt> gives the name of the changelog server to which this LDAP <br>
server is connected.<br>
<tt>received-updates</tt> and sent-updates are the number of changes that this <br>
LDAP server received from the changelgo server and sent to the changelog <br>
server.<br>
<h4>Information about the changelog server databases</h4>
<tt>dn: cn=Changelog database dc=com 1,cn=monitor<br>
objectClass: top<br>
objectClass: extensibleObject<br>
first-change: 0000010c624495ca00000001 Wed Jul 12 12:24:57 CEST 2006<br>
last-change: 0000010c62b94fec00000001 Wed Jul 12 14:32:27 CEST 2006<br>
changelog-database: 1<br>
base-dn: dc=com<br>
cn: Changelog database dc=com 1</tt><br>
<h4>Information about the changelog servers connections to other changelog server and to LDAP servers</h4>
<tt>dn: cn=Changelog Server dc=com voili:8989 2,cn=monitor<br>
objectClass: top<br>
objectClass: extensibleObject<br>
ack-received: 0<br>
ack-sent: 0<br>
server-state: 0000010c62b94fec00000001 Wed Jul 12 14:32:27 CEST 2006<br>
update-received: 0<br>
update-sent: 1<br>
approximate-delay: 0<br>
base-dn: dc=com<br>
Changelog-Server: voili:8989<br>
update-waiting-acks: 0<br>
waiting-changes: 0<br>
server-id: 2<br>
cn: Changelog Server dc=com voili:8989 2<br>
<br>
dn: cn=LDAP Server dc=com furon 1,cn=monitor<br>
objectClass: top<br>
objectClass: extensibleObject<br>
ack-received: 0<br>
ack-sent: 0<br>
server-state: 0000010c62b94fec00000001 Wed Jul 12 14:32:27 CEST 2006<br>
update-received: 1<br>
update-sent: 0<br>
approximate-delay: 0<br>
base-dn: dc=com<br>
update-waiting-acks: 0<br>
LDAP-Server: furon<br>
waiting-changes: 0<br>
server-id: 1<br>
cn: LDAP Server dc=com furon 1</tt><br>
<hr noshade="noshade" size="1" />
<h1>Setting Up Synchronization Among a Larger Number of Masters.</h1>
This setup uses 2 changelog servers for High availability of the service and a number of master LDAP server<br>
The changelog server can be run on hosts that also run LDAP server if the machine has enough CPU and IO bandwidth, or different machines can be used.<br>
<h3>Setup the first changelog server</h3>
<ul>
  <li>Put OpenDS.zip on first changelog server.</li>
  <li>Unzip in your choosen directory.</li>
  <li>Enable the synchronization plugin (copy entry <tt>cn=Multimaster Synchronization,cn=Synchronization Providers,cn=config</tt> from resource/config/synchronization.ldif)</li>
  <li>Configure as a changelog server :</li>
  <ul>
    <li>copy entry : <tt>cn=Changelog Server, </tt><tt>cn=Multimaster Synchronization,cn=Synchronization Providers, </tt><tt>cn=config</tt> from resource/config/synchronization.ldif</li>
    <li>edit the <tt>ds-cfg-changelog-port </tt>attribute to set the port number of this changelog server</li>
    <li>edit the <tt>ds-cfg-changelog-server</tt> attribute to set the hostname and port number of the second changelog server</li>
  </ul>
  <li>Configure the LDAP port. This is necessary because the management and monitoring of the changelog server is done using LDAP protocol even though no LDAP data are kept in the server.</li>
  <ul>
    <li>in entry <tt>cn=LDAP Connection Handler,cn=Connection Handlers,cn=config</tt>, modify the attribute <tt>ds-cfg-listen-port</tt> to your selected port number.</li>
  </ul>
</ul>
<h3>Setup the second changelog server</h3>
<ul>
  <li>Put OpenDS.zip on first changelog server.</li>
  <li>Unzip in your choosen directory.</li>
  <li>Enable the synchronization plugin (copy entry <tt>cn=Multimaster Synchronization,cn=Synchronization Providers,cn=config</tt> from resource/config/synchronization.ldif)</li>
  <li>Configure as a changelog server :</li>
  <ul>
    <li>copy entry : <tt>cn=Changelog Server, </tt><tt>cn=Multimaster Synchronization,cn=Synchronization Providers, </tt><tt>cn=config</tt> from resource/config/synchronization.ldif</li>
    <li>edit the <tt>ds-cfg-changelog-port</tt> attribute to set the port number of this changelog server</li>
    <li>edit the <tt>ds-cfg-changelog-server</tt> attribute to set the hostname and port number of the second changelog server</li>
    <li>edit the <span style="font-family: monospace;">ds-cfg-changelog-server-id</span> attribute to use a different value from the first changelog server.<br>
    </li>
  </ul>
  <li>Configure the LDAP port. This is necessary because the management and monitoring of the changelog server is done using LDAP protocol even though no LDAP data are kept in the server :<br>
  </li>
  <ul>
    <li>&nbsp;in entry <tt>cn=LDAP Connection Handler,cn=Connection Handlers,cn=config</tt>, modify the attribute <tt>ds-cfg-listen-port</tt> to your selected port number.</li>
  </ul>
</ul>
<h3>Setup the first LDAP server</h3>
<ul>
  <li>Put OpenDS.zip on first server.</li>
  <li>Unzip in your choosen directory.</li>
  <li>Edit config/config.ldif :<br>
  </li>
  <ul>
    <li>Set the port number and base-dn :</li>
    <ul>
      <li>in entry <tt>cn=LDAP Connection Handler,cn=Connection Handlers,cn=config</tt>, modify the attribute ds-cfg-listen-port to your selected port number.</li>
      <li>in entry <tt>ds-cfg-backend-id=userRoot,cn=Backends,cn=config</tt>, modify attribute <tt>ds-cfg-backend-base-dn</tt> to your base-dn.</li>
    </ul>
    <li>Configure the suffix base-dn that need to be synchronized :</li>
    <ul>
      <li>Copy entry <tt>cn=example, cn=Multimaster Synchronization,cn=Synchronization Providers,cn=config</tt> from resource/config/synchronization.ldif</li>
      <li>Edit the <tt>ds-cfg-synchronization-dn </tt>attribute to set the base-dn of entries that need to be synchronized.</li>
      <li>Edit the <tt>ds-cfg-changelog-server</tt> attribute to set the hostnames and ports of the 2 changelog servers</li>
      <li>Set the <tt>ds-cfg-server-id</tt> attribute to 1</li>
    </ul>
  </ul>
  <li>Start the server (start-ds.sh or start-ds.bat)</li>
  <li>Populate the data (use ldapmodify or ldapadd or any ldap application)</li>
</ul>
<h3>Setup the other LDAP servers</h3>
Foreach LDAP server :<br>
<ul>
  <li>rcp or ftp the whole directory OpenDS-0.1 to the second hosts</li>
  <li>Edit the config/config.ldif file on the second host</li>
  <ul>
    <li>set the <tt>ds-cfg-server-id</tt> attribute from entry <tt>cn=example,cn=Multimaster Synchronization,cn=Synchronization Providers,cn=config</tt> to some integer value different from the other LDAP servers</li>
  </ul>
  <li>Start the LDAP server</li>
</ul>
<h3>Check that synchronization is working</h3>
<ul>
  <li>Perform an ldapmodify on a synchronized entry on the first server.</li>
  <li>Check with ldapsearch that modification is visible on second server.</li>
</ul>
<h3>Check the monitoring information</h3>
ldapsearch -b cn=monitor "base-dn=&lt;synchronized base dn&gt;"<br>
<br>
</body>
</html>
